// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  email        String   @unique
  hash         String
  hashedRt     String?
  otpConfirmed Boolean  @default(false)
  otpSecret    String

  @@map("users")
}

model Device {
  id                       String            @id @map("_id") @db.String
  createdAt                DateTime          @default(now())
  updatedAt                DateTime          @updatedAt
  name                     String
  last_ip_address          String
  last_heard               DateTime
  last_handshake_at        DateTime
  product_id               Int
  online                   Boolean
  connected                Boolean
  platform_id              Int
  cellular                 Boolean
  notes                    String?
  firmware_updates_enabled Boolean
  firmware_updates_forced  Boolean
  status                   String
  serial_number            String
  system_firmware_version  String
  current_build_target     String
  pinned_build_target      String?
  default_build_target     String
  functions                String[]
  variables                Json?
  shieldVersion            Int?
  firmwareVersion          Float?
  connectedDevices         ConnectedDevice[]

  @@map("devices")
}

model Configuration {
  id             Int               @id @map("_id") @db.Int
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  name           String
  type           ConfigurationType
  temperature    Float
  heatActuator   ConnectedDevice
  coolActuator   ConnectedDevice?
  tempSensor     ConnectedDevice
  heatingPeriod  Int
  coolingPeriod  Int?
  coolingOnTime  Int?
  coolingOffTime Int?
  pid            PID
  fanActuator    ConnectedDevice?
  pump1Actuator  ConnectedDevice?
  pump2Actuator  ConnectedDevice?
  heaterPwm      Float?
  fanPwm         Float?
  pump1Pwm       Float?
  pump2Pwm       Float?
  archived       Boolean           @default(false)

  @@map("configurations")
}

enum ConnectedDeviceType {
  NONE
  ACTUATOR_DIGITAL
  ACTUATOR_PWM
  ONEWIRE_TEMP
}

enum ConfigurationType {
  NONE
  BREW
  FRIDGE
}

type ConnectedDevice {
  type         ConnectedDeviceType
  pinNr        Int
  hwAddress    String
  connected    Boolean?            @default(false)
  name         String?
  offset       Float?              @default(0.0)
  deviceOffset Float?              @default(0.0)
}

type PID {
  p Float
  i Float
  d Float
}
